app = "platform-capitalism-sim"
primary_region = "ord"

[build]
  dockerfile = "Dockerfile"
  build_args = { PYTHON_VERSION = "3.11", APP_ENV = "production" }

[http_service]
  internal_port = 8000
  force_https = true
  auto_stop_machines = false # Keep alive for persistent simulations

  [[http_service.ports]]
    handlers = ["http"]
    port = 80

  [[http_service.ports]]
    handlers = ["tls", "http"]
    port = 443

[mounts]
  source = "simulation_data"
  destination = "/data" # Persistent volume for simulation state

[env]
  PYTHONUNBUFFERED = "1"
  PYTHONPATH = "/app"
  FASTHTML_DEBUG = "false"
  SIMULATION_PERSIST = "true"

[[statics]]
  guest_path = "/app/static"
  url_prefix = "/static"

[deploy]
  strategy = "rolling"
  max_unavailable = 0 # Zero-downtime deployments